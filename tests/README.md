# RealtimeMix æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„å¤šç»´åº¦æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºéªŒè¯ `realtimemix` åº“çš„åŠŸèƒ½ã€æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

## ğŸ“ æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ conftest.py                    # æµ‹è¯•é…ç½®å’Œé€šç”¨ fixtures
â”œâ”€â”€ test_basic_functionality.py   # åŸºæœ¬åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_matchering_integration.py # Matchering é›†æˆæµ‹è¯•
â”œâ”€â”€ test_advanced_features.py     # é«˜çº§åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_benchmarks.py           # æ€§èƒ½åŸºå‡†æµ‹è¯•
â”œâ”€â”€ test_runner.py               # æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ pytest.ini                  # pytest é…ç½®
â”œâ”€â”€ requirements-test.txt        # æµ‹è¯•ä¾èµ–
â””â”€â”€ README.md                   # æœ¬æ–‡ä»¶
```

## ğŸ§ª æµ‹è¯•å¥—ä»¶è¯´æ˜

### 1. åŸºæœ¬åŠŸèƒ½æµ‹è¯• (`test_basic_functionality.py`)
- **AudioEngine åˆå§‹åŒ–å’Œé…ç½®**
- **éŸ³è½¨åŠ è½½/å¸è½½æ“ä½œ**
- **æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾ã€åœæ­¢ã€éŸ³é‡è°ƒèŠ‚ï¼‰**
- **å¤šè½¨é“ç®¡ç†**
- **é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶**
- **æµå¼æ’­æ”¾ vs é¢„åŠ è½½æ¨¡å¼**
- **æ€§èƒ½ç»Ÿè®¡æ”¶é›†**

### 2. Matchering é›†æˆæµ‹è¯• (`test_matchering_integration.py`)
- **åŸºæœ¬ matchering åŠŸèƒ½**
- **ä¸åŒå‚è€ƒä½ç½®çš„åŒ¹é…**
- **å¤šç§éŸ³é¢‘æ ¼å¼æ”¯æŒ**
- **è¾¹ç•Œæ¡ä»¶å¤„ç†**
- **ä¸´æ—¶æ–‡ä»¶æ¸…ç†**
- **é”™è¯¯å¤„ç†å’Œæ¢å¤**
- **æ€§èƒ½æµ‹è¯•**

### 3. é«˜çº§åŠŸèƒ½æµ‹è¯• (`test_advanced_features.py`)
- **æ— ç¼éŸ³è½¨åˆ‡æ¢**
- **äº¤å‰æ·¡åŒ–æ¨¡æ‹Ÿ**
- **å¤šè½¨é“æ··éŸ³**
- **åŒæ­¥æ’­æ”¾**
- **èµ„æºç®¡ç†**
- **å¹¶å‘æ“ä½œ**
- **å¤æ‚åº”ç”¨åœºæ™¯**

### 4. æ€§èƒ½åŸºå‡†æµ‹è¯• (`test_benchmarks.py`)
- **åŠ è½½é€Ÿåº¦åŸºå‡†**
- **æ’­æ”¾å»¶è¿Ÿæµ‹è¯•**
- **CPU ä½¿ç”¨ç‡ç›‘æ§**
- **å†…å­˜ä½¿ç”¨æ‰©å±•æ€§**
- **æœ€å¤§å¹¶å‘è½¨é“æ•°**
- **é•¿æœŸç¨³å®šæ€§**
- **èµ„æºæ•ˆç‡**

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…æµ‹è¯•ä¾èµ–

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install -r tests/requirements-test.txt
```

### è¿è¡Œæµ‹è¯•

#### 1. ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨ï¼ˆæ¨èï¼‰

```bash
# å¿«é€Ÿæ£€æŸ¥
python tests/test_runner.py quick

# è¿è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•
python tests/test_runner.py basic

# è¿è¡Œ matchering é›†æˆæµ‹è¯•
python tests/test_runner.py matchering

# è¿è¡Œé«˜çº§åŠŸèƒ½æµ‹è¯•
python tests/test_runner.py advanced

# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
python tests/test_runner.py performance

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python tests/test_runner.py all

# è¯¦ç»†è¾“å‡º
python tests/test_runner.py all -v

# ä¸ç”ŸæˆæŠ¥å‘Š
python tests/test_runner.py basic --no-report
```

#### 2. ç›´æ¥ä½¿ç”¨ pytest

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_basic_functionality.py

# è¯¦ç»†è¾“å‡º
pytest tests/ -v

# å¹¶è¡Œæµ‹è¯•
pytest tests/ -n auto

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=realtimemix --cov-report=html
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•è¿è¡Œå™¨ä¼šè‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼š

- **JSON æŠ¥å‘Š**: åŒ…å«å®Œæ•´çš„æµ‹è¯•æ•°æ®å’Œç»“æœ
- **HTML æŠ¥å‘Š**: ç¾è§‚çš„å¯è§†åŒ–æµ‹è¯•æŠ¥å‘Š

æŠ¥å‘Šå­˜å‚¨åœ¨ `tests/reports/` ç›®å½•ä¸­ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### åŠŸèƒ½è¦†ç›–
- âœ… éŸ³é¢‘å¼•æ“åˆå§‹åŒ–å’Œé…ç½®
- âœ… éŸ³è½¨åŠ è½½ï¼ˆé¢„åŠ è½½å’Œæµå¼ï¼‰
- âœ… æ’­æ”¾æ§åˆ¶å’ŒçŠ¶æ€ç®¡ç†
- âœ… éŸ³é‡æ§åˆ¶å’ŒåŠ¨æ€è°ƒæ•´
- âœ… Matchering éŸ³é¢‘åŒ¹é…
- âœ… å¤šè½¨é“åŒæ—¶æ’­æ”¾
- âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤
- âœ… èµ„æºç®¡ç†å’Œæ¸…ç†

### æ€§èƒ½è¦†ç›–
- âœ… åŠ è½½é€Ÿåº¦åŸºå‡†
- âœ… æ’­æ”¾å»¶è¿Ÿæµ‹è¯•
- âœ… CPU ä½¿ç”¨ç‡ç›‘æ§
- âœ… å†…å­˜ä½¿ç”¨åˆ†æ
- âœ… å¹¶å‘æ€§èƒ½æµ‹è¯•
- âœ… é•¿æœŸç¨³å®šæ€§éªŒè¯

### å…¼å®¹æ€§è¦†ç›–
- âœ… å¤šç§é‡‡æ ·ç‡ (22050, 44100, 48000, 96000 Hz)
- âœ… å¤šç§å£°é“é…ç½® (å•å£°é“, ç«‹ä½“å£°)
- âœ… ä¸åŒéŸ³é¢‘æ ¼å¼å’Œæ—¶é•¿
- âœ… å„ç§éŸ³é‡çº§åˆ« (é™éŸ³, ä½éŸ³é‡, é«˜éŸ³é‡)

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨é€‚å½“çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æµ‹è¯•å‡½æ•°
2. ä½¿ç”¨ pytest æ ‡è®°è¿›è¡Œåˆ†ç±»
3. åˆ©ç”¨ `conftest.py` ä¸­çš„ fixtures

### ç¤ºä¾‹æµ‹è¯•å‡½æ•°

```python
import pytest

def test_custom_feature(audio_engine, test_audio_files):
    """æµ‹è¯•è‡ªå®šä¹‰åŠŸèƒ½"""
    # æµ‹è¯•é€»è¾‘
    assert True

@pytest.mark.slow
def test_slow_operation(audio_engine):
    """æ…¢é€Ÿæµ‹è¯•ç¤ºä¾‹"""
    # è€—æ—¶æ“ä½œ
    pass

@pytest.mark.matchering
def test_matchering_feature(audio_engine, test_audio_files):
    """éœ€è¦ matchering çš„æµ‹è¯•"""
    # matchering ç›¸å…³æµ‹è¯•
    pass
```

### è‡ªå®šä¹‰ Fixtures

åœ¨ `conftest.py` ä¸­æ·»åŠ æ–°çš„ fixturesï¼š

```python
@pytest.fixture
def custom_engine():
    """è‡ªå®šä¹‰å¼•æ“é…ç½®"""
    engine = AudioEngine(
        sample_rate=96000,
        buffer_size=512,
        channels=2
    )
    engine.start()
    yield engine
    engine.shutdown()
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### åŸºå‡†æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| éŸ³è½¨åŠ è½½æ—¶é—´ | < 10% éŸ³é¢‘æ—¶é•¿ | åŠ è½½æ•ˆç‡ |
| æ’­æ”¾å¯åŠ¨å»¶è¿Ÿ | < 50ms | å“åº”é€Ÿåº¦ |
| CPU ä½¿ç”¨ç‡ | < 50% (8è½¨é“) | èµ„æºæ•ˆç‡ |
| å†…å­˜ä½¿ç”¨ | < 50MB/è½¨é“ | å†…å­˜æ•ˆç‡ |
| æœ€å¤§å¹¶å‘è½¨é“ | â‰¥ 8 | æ‰©å±•æ€§ |

### æ€§èƒ½ç›‘æ§

æµ‹è¯•å¥—ä»¶ä¼šè‡ªåŠ¨ç›‘æ§ä»¥ä¸‹æ€§èƒ½æŒ‡æ ‡ï¼š
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨é‡
- éŸ³é¢‘ç¼“å†²åŒºæ¬ è½½æ¬¡æ•°
- å³°å€¼éŸ³é¢‘ç”µå¹³
- æ–‡ä»¶å¥æŸ„ä½¿ç”¨

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Matchering åº“æœªå®‰è£…**
   ```bash
   pip install matchering
   ```

2. **éŸ³é¢‘è®¾å¤‡é—®é¢˜**
   - ç¡®ä¿ç³»ç»Ÿæœ‰å¯ç”¨çš„éŸ³é¢‘è¾“å‡ºè®¾å¤‡
   - æ£€æŸ¥éŸ³é¢‘é©±åŠ¨ç¨‹åº

3. **æƒé™é—®é¢˜**
   - ç¡®ä¿æœ‰å†™å…¥ä¸´æ—¶ç›®å½•çš„æƒé™
   - æ£€æŸ¥éŸ³é¢‘è®¾å¤‡è®¿é—®æƒé™

4. **å†…å­˜ä¸è¶³**
   - å‡å°‘å¹¶å‘æµ‹è¯•æ•°é‡
   - ä½¿ç”¨æµå¼æ’­æ”¾æ¨¡å¼

### è°ƒè¯•æŠ€å·§

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
pytest tests/ -v -s --log-cli-level=DEBUG

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest tests/ --lf

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥æ—¶åœæ­¢
pytest tests/ -x

# ç¦ç”¨æ•è·ä»¥æŸ¥çœ‹å®æ—¶è¾“å‡º
pytest tests/ -s
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. ç¡®å®šæµ‹è¯•ç±»åˆ«ï¼ˆåŸºæœ¬/é«˜çº§/æ€§èƒ½/é›†æˆï¼‰
2. ç¼–å†™æ¸…æ™°çš„æµ‹è¯•å‡½æ•°å’Œæ–‡æ¡£
3. æ·»åŠ é€‚å½“çš„ pytest æ ‡è®°
4. æ›´æ–°æ­¤ README æ–‡æ¡£

### ä»£ç é£æ ¼

- éµå¾ª PEP 8 è§„èŒƒ
- ä½¿ç”¨ç±»å‹æç¤º
- ç¼–å†™æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š

### æäº¤æµ‹è¯•

1. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿é€šè¿‡
2. æ£€æŸ¥ä»£ç é£æ ¼
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. æäº¤ Pull Request

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨æµ‹è¯•å¥—ä»¶æ—¶é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ­¤ README çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥æµ‹è¯•æŠ¥å‘Šä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. è¿è¡Œå¿«é€Ÿæ£€æŸ¥è¯Šæ–­ç¯å¢ƒé—®é¢˜
4. æäº¤ Issue å¹¶é™„ä¸Šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

---

**æ³¨æ„**: æ­¤æµ‹è¯•å¥—ä»¶éœ€è¦çœŸå®çš„éŸ³é¢‘è®¾å¤‡å’Œç›¸å…³æƒé™ã€‚åœ¨ CI/CD ç¯å¢ƒä¸­å¯èƒ½éœ€è¦ç‰¹æ®Šé…ç½®ã€‚ 